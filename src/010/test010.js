function enableBlend(a){a.enable(a.BLEND);}function setBlendFunc(a,b,c,d){a.blendFunc(b,c),d&&a.blendEquation(d);}function setBlendModeNormal(a){setBlendFunc(a,a.ONE,a.ONE_MINUS_SRC_ALPHA,a.FUNC_ADD);}

class DrawCall{constructor(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;this.gl=a,this.appState=b,this.currentProgram=c,this.drawPrimitive=a.TRIANGLES,this.currentVertexArray=d,this.appState=b,this.uniformIndices={},this.uniformNames=Array(b.maxUniforms),this.uniformValues=Array(b.maxUniforms),this.uniformCount=0,this.uniformBuffers=Array(b.maxUniformBuffers),this.uniformBlockNames=Array(b.maxUniformBuffers),this.uniformBlockCount=0,this.textures=Array(b.maxTextureUnits),this.textureCount=0,this.offsets=new Int32Array(1),this.numElements=new Int32Array(1),this.numInstances=new Int32Array(1),d&&(this.numElements[0]=d.numElements,this.numInstances[0]=d.numInstances),this.numDraws=1;}setPrimitive(a){return this.drawPrimitive=a,this}uniform(a,b){var c=this.uniformIndices[a];return void 0===c&&(c=this.uniformCount++,this.uniformIndices[a]=c,this.uniformNames[c]=a),this.uniformValues[c]=b,this}uniformBlock(a,b){var c=this.currentProgram.uniformBlocks[a];return this.uniformBuffers[c]=b,this}texture(a,b){var c=this.currentProgram.samplers[a];return this.textures[c]=b,this}drawRanges(){this.numDraws=arguments.length,this.offsets.length<this.numDraws&&(this.offsets=new Int32Array(this.numDraws)),this.numElements.length<this.numDraws&&(this.numElements=new Int32Array(this.numDraws)),this.numInstances.length<this.numDraws&&(this.numInstances=new Int32Array(this.numDraws));for(var a,b=0;b<this.numDraws;++b)a=0>b||arguments.length<=b?void 0:arguments[b],this.offsets[b]=a[0],this.numElements[b]=a[1],this.numInstances[b]=a[2]||1;return this}draw(){var a=this.gl,b=this.appState,c=this.uniformNames,d=this.uniformValues,e=this.uniformBuffers,f=this.currentProgram.uniformBlockCount,g=this.textures,h=this.currentProgram.samplerCount,j=this.drawPrimitive,k=this.numElements,l=this.numInstances,m=this.currentVertexArray,n=this.offsets,o=this.numDraws,p=!1;this.currentProgram.bind(),m&&(m.bind(),p=m.indexed);for(var q=0;q<this.uniformCount;q++)this.currentProgram.uniform(c[q],d[q]);for(var r=0;r<f;r++)e[r].bind(r);for(var s=0;s<h;s++)g[s].bind(s);if(b.multiDrawInstanced){var t=b.extensions.multiDrawInstanced;p?t.multiDrawElementsInstancedWEBGL(j,k,0,m.indexType,n,0,l,0,o):t.multiDrawArraysInstancedWEBGL(j,n,0,k,0,l,0,o);}else if(p)for(var u=0;u<o;u++)a.drawElementsInstanced(j,k[u],m.indexType,n[u],l[u]);else for(var i=0;i<o;i++)a.drawArraysInstanced(j,n[i],k[i],l[i]);return this}}

class Texture{constructor(a,b,c,d){var e=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,f=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,g=6<arguments.length&&arguments[6]!==void 0?arguments[6]:0,h=!!(7<arguments.length&&arguments[7]!==void 0)&&arguments[7],i=8<arguments.length&&arguments[8]!==void 0?arguments[8]:{};this.gl=a,this.appState=b,this.binding=c,this.texture=null,d&&d.width&&(e=d.width),d&&d.height&&(f=d.height),this.width=e,this.height=f,this.depth=g,this.is3D=h,this.compressed=!!i.compressed,this.compressed?(this.internalFormat=i.internalFormat,this.format=this.internalFormat,this.type=a.UNSIGNED_BYTE):i.internalFormat?(this.internalFormat=i.internalFormat,this.format=i.format,this.type=i.type):(this.internalFormat=a.RGBA8,this.format=a.RGBA,this.type=a.UNSIGNED_BYTE),this.currentUnit=-1;var{minFilter:j=d?a.LINEAR_MIPMAP_NEAREST:a.NEAREST,magFilter:k=d?a.LINEAR:a.NEAREST,wrapS:l=a.REPEAT,wrapT:m=a.REPEAT,wrapR:n=a.REPEAT,compareMode:o=a.NONE,compareFunc:p=a.LEQUAL,minLOD:q=null,maxLOD:r=null,baseLevel:s=null,maxLevel:t=null,maxAnisotropy:u=1,flipY:v=!0,premultiplyAlpha:w=!0}=i;this.minFilter=j,this.magFilter=k,this.wrapS=l,this.wrapT=m,this.wrapR=n,this.compareMode=o,this.compareFunc=p,this.minLOD=q,this.maxLOD=r,this.baseLevel=s,this.maxLevel=t,this.maxAnisotropy=Math.min(u,b.maxTextureUnits),this.flipY=v,this.premultiplyAlpha=w,this.mipmaps=j===a.LINEAR_MIPMAP_NEAREST||j===a.LINEAR_MIPMAP_LINEAR,this.restore(d);}restore(a){return this.texture=null,this.resize(this.width,this.height,this.depth),a&&this.data(a),this}resize(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,d=this.gl,e=this.binding,f=this.texture;if(f&&a===this.width&&b===this.height&&c===this.depth)return this;f&&d.deleteTexture(f),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),f=d.createTexture(),this.texture=f,this.bind(Math.max(this.currentUnit,0)),this.width=a,this.height=b,this.depth=c,d.texParameteri(e,d.TEXTURE_MIN_FILTER,this.minFilter),d.texParameteri(e,d.TEXTURE_MAG_FILTER,this.magFilter),d.texParameteri(e,d.TEXTURE_WRAP_S,this.wrapS),d.texParameteri(e,d.TEXTURE_WRAP_T,this.wrapT),d.texParameteri(e,d.TEXTURE_WRAP_R,this.wrapR),d.texParameteri(e,d.TEXTURE_COMPARE_FUNC,this.compareFunc),d.texParameteri(e,d.TEXTURE_COMPARE_MODE,this.compareMode),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,this.flipY),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),null!==this.minLOD&&d.texParameterf(e,d.TEXTURE_MIN_LOD,this.minLOD),null!==this.maxLOD&&d.texParameterf(e,d.TEXTURE_MAX_LOD,this.maxLOD),null!==this.baseLevel&&d.texParameteri(e,d.TEXTURE_BASE_LEVEL,this.baseLevel),null!==this.maxLevel&&d.texParameteri(e,d.TEXTURE_MAX_LEVEL,this.maxLevel),1<this.maxAnisotropy&&d.texParameteri(e,d[34046],this.maxAnisotropy);var g=1;return this.is3D?(this.mipmaps&&(g=Math.floor(Math.log2(Math.max(Math.max(a,b),c)))+1),d.texStorage3D(e,g,this.internalFormat,a,b,c)):(this.mipmaps&&(g=Math.floor(Math.log2(Math.max(a,b)))+1),d.texStorage2D(e,g,this.internalFormat,a,b)),this}data(a){var b,c=this.gl,d=this.binding,e=Array.isArray(a)?a:[a],f=this.width,g=this.height,h=this.depth,j=this.format,k=this.type,l=this.is3D,m=this.mipmaps?e.length:1,n=this.mipmaps&&1===e.length;if(this.bind(Math.max(this.currentUnit,0)),this.compressed){if(l)for(b=0;b<m;b++)c.compressedTexSubImage3D(d,b,0,0,0,f,g,h,j,e[b]),f=Math.max(f>>1,1),g=Math.max(g>>1,1),h=Math.max(h>>1,1);else for(b=0;b<m;b++)c.compressedTexSubImage2D(d,b,0,0,f,g,j,e[b]),f=Math.max(f>>1,1),g=Math.max(g>>1,1);}else if(l)for(b=0;b<m;b++)c.texSubImage3D(d,b,0,0,0,f,g,h,j,k,e[b]),f=Math.max(f>>1,1),g=Math.max(g>>1,1),h=Math.max(h>>1,1);else for(b=0;b<m;b++)c.texSubImage2D(d,b,0,0,f,g,j,k,e[b]),f=Math.max(f>>1,1),g=Math.max(g>>1,1);return n&&c.generateMipmap(d),this}delete(){var a=this.gl,b=this.appState;return this.texture&&(a.deleteTexture(this.texture),this.texture=null,-1!==this.currentUnit&&b.textures[this.currentUnit]===this&&(b.textures[this.currentUnit]=null,this.currentUnit=-1)),this}bind(a){var b=this.gl,c=this.appState,d=c.textures[a];return d!==this&&(d&&(d.currentUnit=-1),-1!==this.currentUnit&&(c.textures[this.currentUnit]=null),b.activeTexture(b.TEXTURE0+a),b.bindTexture(this.binding,this.texture),c.textures[a]=this,this.currentUnit=a),this}}

var TYPE_SIZE={5120:1,5121:1,5122:2,5123:2,5124:4,5125:4,5126:4};function GetTypeSize(a){return TYPE_SIZE[a]}

var SAMPLER_TYPE=["1i",1,Int32Array,!1],glConstMap={35678:SAMPLER_TYPE,36289:SAMPLER_TYPE,35682:SAMPLER_TYPE,36292:SAMPLER_TYPE,36298:SAMPLER_TYPE,36303:SAMPLER_TYPE,36306:SAMPLER_TYPE,36311:SAMPLER_TYPE,35680:SAMPLER_TYPE,36300:SAMPLER_TYPE,36308:SAMPLER_TYPE,36293:SAMPLER_TYPE,35679:SAMPLER_TYPE,36299:SAMPLER_TYPE,36307:SAMPLER_TYPE,5126:["1f",1,Float32Array,!1,1,5126,1],35664:["2f",2,Float32Array,!1,2,5126,2],35665:["3f",3,Float32Array,!1,4,5126,4],35666:["4f",4,Float32Array,!1,4,5126,4],5124:["1i",1,Int32Array,!1,1,5124,1],35667:["2i",2,Int32Array,!1,2,5124,2],35668:["3i",3,Int32Array,!1,4,5124,4],35669:["4i",4,Int32Array,!1,4,5124,4],5125:["1ui",1,Uint32Array,!1,1,5125,1],36294:["2ui",2,Uint32Array,!1,2,5125,2],36295:["3ui",3,Uint32Array,!1,4,5125,4],36296:["4ui",4,Uint32Array,!1,4,5125,4],35674:["2fv",4,Float32Array,!0,4,5126,8],35675:["3fv",9,Float32Array,!0,4,5126,12],35676:["4fv",16,Float32Array,!0,4,5126,16],35685:["2x3fv",6,Float32Array,!0,4,5126,8],35686:["2x4fv",8,Float32Array,!0,4,5126,8],35687:["3x2fv",6,Float32Array,!0,4,5126,12],35688:["3x4fv",12,Float32Array,!0,4,5126,12],35689:["4x2fv",8,Float32Array,!0,4,5126,16],35690:["4x3fv",12,Float32Array,!0,4,5126,16],35670:["1iv",1,Array,!1,1,5126,1],35671:["2iv",2,Array,!1,2,5126,2],35672:["3iv",3,Array,!1,4,5126,4],35673:["4iv",4,Array,!1,4,5126,4]};function GetUniformSize(a){var b=glConstMap[a];return b?{size:b[4],uboType:b[5],stride:b[6]}:null}function GetUniform(a,b){var c=glConstMap[b];if(c){var d="uniform";return c[3]&&(d=d.concat("Matrix")),{glFunc:a[d+c[0]],size:c[1],cacheClass:a=>new c[2](a)}}return null}

class MatrixUniform{constructor(a,b,c,d){this.gl=a,this.handle=b,this.count=d;var e=GetUniform(a,c.type);this.glFunc=e.glFunc,this.cache=e.cacheClass(e.size*d);}set(a){for(var b=0;b<a.length;b++)if(this.cache[b]!==a[b])return this.glFunc(this.handle,!1,a),void this.cache.set(a)}}

class MultiBoolUniform{constructor(a,b,c,d){this.gl=a,this.handle=b,this.count=d;var e=GetUniform(a,c.type);this.glFunc=e.glFunc,this.cache=Array(e.size*d).fill(!1);}set(a){for(var b=0;b<a.length;b++)if(this.cache[b]!==a[b]){this.glFunc(this.handle,a);for(var c=b;c<a.length;c++)this.cache[c]=a[c];return}}}

class MultiNumericUniform{constructor(a,b,c,d){this.gl=a,this.handle=b,this.count=d;var e=GetUniform(a,c.type);this.glFunc=e.glFunc,this.cache=e.cacheClass(e.size*d);}set(a){for(var b=0;b<a.length;b++)if(this.cache[b]!==a[b])return this.glFunc(this.handle,a),void this.cache.set(a)}}

var UNIFORMS={SAMPLER:[35678,36298,36306,35682,36289,36303,36311,36292,35680,36300,36308,36293,35679,36299,36307],VEC:[35664,35667,36294,35665,35668,36295,35666,35669,36296],BOOL:[35670,35671,35672,35673],MAT:[35674,35675,35676,35685,35686,35687,35688,35689,35690]};

class Shader{constructor(a,b,c,d){this.gl=a,this.appState=b,this.type=c,this.source=d,this.restore();}restore(){var a=this.gl,b=a.createShader(this.type);return a.shaderSource(b,this.source),a.compileShader(b),this.shader=b,this}delete(){return this.shader&&(this.gl.deleteShader(this.shader),this.shader=null),this}checkCompilation(){var a=this.gl,b=this.shader;if(!a.getShaderParameter(b,a.COMPILE_STATUS)){console.error(a.getShaderInfoLog(b));for(var c=this.source.split("\n"),d=0;d<c.length;++d)console.error("".concat(d+1,": ").concat(c[d]));}return this}}

class SingleComponentUniform{constructor(a,b,c){this.gl=a,this.handle=b;var d=GetUniform(a,c.type);this.glFunc=d.glFunc,this.cache=c.type!==a.BOOL&&0;}set(a){this.cache!==a&&(this.glFunc(this.handle,a),this.cache=a);}}

class Program{constructor(a,b,c,d){this.uniforms={},this.uniformBlocks={},this.uniformBlockCount=0,this.samplers={},this.samplerCount=0,this.linked=!1,this.gl=a,this.appState=b,"string"==typeof c?this.vertexSource=c:this.vertexShader=c,"string"==typeof d?this.fragmentSource=d:this.fragmentShader=d,this.initialize();}initialize(){var a=this.gl,b=this.appState;return b.program===this&&(a.useProgram(null),b.program=null),this.linked=!1,this.uniformBlockCount=0,this.samplerCount=0,this.vertexSource&&(this.vertexShader=new Shader(a,b,a.VERTEX_SHADER,this.vertexSource)),this.fragmentSource&&(this.fragmentShader=new Shader(a,b,a.FRAGMENT_SHADER,this.fragmentSource)),this.program=this.gl.createProgram(),this}link(){var a=this.gl,b=this.program;return a.attachShader(b,this.vertexShader.shader),a.attachShader(b,this.fragmentShader.shader),a.linkProgram(b),this}checkCompletion(){return !this.gl.getExtension("KHR_parallel_shader_compile")||this.gl.getProgramParameter(this.program,37297)}checkLinkage(){if(this.linked)return this;var a=this.gl,b=this.program;return a.getProgramParameter(b,a.LINK_STATUS)?(this.linked=!0,this.initVariables()):(console.error(a.getProgramInfoLog(b)),this.vertexShader.checkCompilation(),this.fragmentShader.checkCompilation()),this.vertexSource&&(this.vertexShader.delete(),this.vertexShader=null),this.fragmentSource&&(this.fragmentShader.delete(),this.fragmentShader=null),this}initVariables(){this.bind();for(var a,b=this.gl,c=this.program,d=b.getProgramParameter(c,b.ACTIVE_UNIFORMS),e=0;e<d;e++){var f=b.getActiveUniform(c,e),g=b.getUniformLocation(c,f.name),h=f.type,j=f.size;-1===UNIFORMS.SAMPLER.indexOf(h)?-1===UNIFORMS.VEC.indexOf(h)?-1===UNIFORMS.MAT.indexOf(h)?-1===UNIFORMS.BOOL.indexOf(h)?h===b.INT||h===b.UNSIGNED_INT||h===b.FLOAT?1<j?this.uniforms[f.name]=new MultiNumericUniform(b,g,f,j):this.uniforms[f.name]=new SingleComponentUniform(b,g,f):console.error("Unknown uniform type"):1<j?this.uniforms[f.name]=new MultiBoolUniform(b,g,f,j):this.uniforms[f.name]=new SingleComponentUniform(b,g,f):this.uniforms[f.name]=new MatrixUniform(b,g,f,j):this.uniforms[f.name]=new MultiNumericUniform(b,g,f,j):(a=this.samplerCount++,this.samplers[f.name]=a,b.uniform1i(g,a));}for(var k=b.getProgramParameter(c,b.ACTIVE_UNIFORM_BLOCKS),l=0;l<k;l++){var m=b.getActiveUniformBlockName(c,l),n=b.getUniformBlockIndex(c,m),o=this.uniformBlockCount++;b.uniformBlockBinding(c,n,o),this.uniformBlocks[m]=o;}}uniform(a,b){return this.uniforms[a]&&this.uniforms[a].set(b),this}bind(){var a=this.appState;return a.program!==this&&(this.gl.useProgram(this.program),a.program=this),this}delete(){return this.program&&(this.gl.deleteProgram(this.program),this.program=null,this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null)),this}}

class UniformBuffer{constructor(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:a.DYNAMIC_DRAW;this.gl=a,this.appState=b,this.buffer=null,this.dataViews={};var e=c.length,f=Array(e),g=Array(e),h=Array(e);this.size=0,this.usage=d,this.currentBase=-1;for(var k=0;k<e;k++){var{size:i,uboType:l,stride:m}=GetUniformSize(c[k]);2===i?this.size+=this.size%2:4===i&&(this.size+=(4-this.size%4)%4),f[k]=this.size,g[k]=m,h[k]=l,this.size+=m;}this.offsets=f,this.sizes=g,this.types=h,this.size+=(4-this.size%4)%4;var j=new Float32Array(this.size);this.dataViews[a.FLOAT]=j,this.dataViews[a.INT]=new Int32Array(j.buffer),this.dataViews[a.UNSIGNED_INT]=new Uint32Array(j.buffer),this.data=j,this.dirtyStart=this.size,this.dirtyEnd=0,this.restore();}restore(){var a=this.gl,b=this.appState,c=this.currentBase;return -1!==c&&b.uniformBuffers[c]===this&&(b.uniformBuffers[c]=null),this.buffer=a.createBuffer(),a.bindBuffer(a.UNIFORM_BUFFER,this.buffer),a.bufferData(a.UNIFORM_BUFFER,4*this.size,this.usage),a.bindBuffer(a.UNIFORM_BUFFER,null),this}set(a,b){var c=this.dataViews[this.types[a]],d=this.offsets[a],e=this.sizes[a];return 1===this.sizes[a]?c[d]=b:c.set(b,d),d<this.dirtyStart&&(this.dirtyStart=d),this.dirtyEnd<d+e&&(this.dirtyEnd=d+e),this}update(){var a=this.gl;if(this.dirtyStart>=this.dirtyEnd)return this;var b=this.data.subarray(this.dirtyStart,this.dirtyEnd),c=4*this.dirtyStart;return a.bindBuffer(a.UNIFORM_BUFFER,this.buffer),a.bufferSubData(a.UNIFORM_BUFFER,c,b),a.bindBuffer(a.UNIFORM_BUFFER,null),this.dirtyStart=this.size,this.dirtyEnd=0,this}delete(){var a=this.gl,b=this.appState,c=this.currentBase;return this.buffer&&(a.deleteBuffer(this.buffer),this.buffer=null,-1!==c&&b.uniformBuffers[c]===this&&(b.uniformBuffers[c]=null)),this}bind(a){var b=this.gl,c=this.appState,d=this.currentBase,e=c.uniformBuffers[a];return e!==this&&(e&&(e.currentBase=-1),-1!==d&&(c.uniformBuffers[d]=null),b.bindBufferBase(b.UNIFORM_BUFFER,a,this.buffer),c.uniformBuffers[a]=this,this.currentBase=a),this}}

class VertexArray{constructor(a,b){this.gl=a,this.appState=b,this.vertexArray=null,this.indexType=null,this.indexed=!1,this.numElements=0,this.numInstances=1,this.offsets=0,this.numDraws=1;}restore(){var a=this.appState;return a.vertexArray===this&&(a.vertexArray=null),null!==this.vertexArray&&(this.vertexArray=this.gl.createVertexArray()),this}vertexAttributeBuffer(a,b,c){return this.attributeBuffer(a,b,c,!1),this}instanceAttributeBuffer(a,b,c){return this.attributeBuffer(a,b,c,!0),this}indexBuffer(a){var b=this.gl;return null===this.vertexArray&&(this.vertexArray=b.createVertexArray()),this.bind(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.buffer),this.numElements=3*a.numItems,this.indexType=a.type,this.indexed=!0,this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null,this.appState.vertexArray===this&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null)),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},d=3<arguments.length?arguments[3]:void 0,e=this.gl;null===this.vertexArray&&(this.vertexArray=e.createVertexArray()),this.bind(),e.bindBuffer(e.ARRAY_BUFFER,b.buffer);var{type:f=b.type,size:g=b.itemSize,offset:h=0,normalized:j=!1,integer:k=b.integer&&!j}=c,{stride:l=0}=c,m=b.numColumns;0===l&&(l=m*g*GetTypeSize(f));for(var n=0;n<m;n++)k?e.vertexAttribIPointer(a+n,g,f,l,h+n*g*GetTypeSize(f)):e.vertexAttribPointer(a+n,g,f,j,l,h+n*g*GetTypeSize(f)),d&&e.vertexAttribDivisor(a+n,1),e.enableVertexAttribArray(a+n);return 1===this.numDraws&&(d?this.numInstances=b.numItems:this.numElements=this.numElements||b.numItems),e.bindBuffer(e.ARRAY_BUFFER,null),this}}

class VertexBuffer{constructor(a,b,c,d,e){var f=5<arguments.length&&arguments[5]!==void 0?arguments[5]:a.STATIC_DRAW,g=!!(6<arguments.length&&arguments[6]!==void 0)&&arguments[6];this.gl=a,this.appState=b,this.buffer=null;var h=1;c===a.FLOAT_MAT4||c===a.FLOAT_MAT4x2||c===a.FLOAT_MAT4x3?h=4:c===a.FLOAT_MAT3||c===a.FLOAT_MAT3x2||c===a.FLOAT_MAT3x4?h=3:(c===a.FLOAT_MAT2||c===a.FLOAT_MAT2x3||c===a.FLOAT_MAT2x4)&&(h=2),c===a.FLOAT_MAT4||c===a.FLOAT_MAT3x4||c===a.FLOAT_MAT2x4?(d=4,c=a.FLOAT):c===a.FLOAT_MAT3||c===a.FLOAT_MAT4x3||c===a.FLOAT_MAT2x3?(d=3,c=a.FLOAT):(c===a.FLOAT_MAT2||c===a.FLOAT_MAT3x2||c===a.FLOAT_MAT4x2)&&(d=2,c=a.FLOAT);var i,j;"number"==typeof e?(i=e,c&&(e*=GetTypeSize(c)),j=e):(j=e.byteLength,i=e.length),this.type=c,this.itemSize=d,this.numItems=c?i/(d*h):j/d,this.numColumns=h,this.byteLength=j,this.usage=f,this.indexArray=!!g,this.integer=c===a.BYTE||c===a.UNSIGNED_BYTE||c===a.SHORT||c===a.UNSIGNED_SHORT||c===a.INT||c===a.UNSIGNED_INT,this.binding=this.indexArray?a.ELEMENT_ARRAY_BUFFER:a.ARRAY_BUFFER,this.restore(e);}restore(a){var b=this.gl,c=this.appState,d=this.binding;return c.vertexArray&&(b.bindVertexArray(null),c.vertexArray=null),this.buffer=b.createBuffer(),b.bindBuffer(d,this.buffer),void 0===a?b.bufferData(d,this.byteLength,this.usage):b.bufferData(d,a,this.usage),b.bindBuffer(d,null),this}data(a){var b=this.gl,c=this.appState,d=this.binding;return c.vertexArray&&(b.bindVertexArray(null),c.vertexArray=null),b.bindBuffer(d,this.buffer),b.bufferSubData(d,0,a),b.bindBuffer(d,null),this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this}}

class WebGL2Renderer{constructor(a,b){this.width=0,this.height=0,this.viewport={x:0,y:0,width:0,height:0},this.currentDrawCalls=0,this.contextLostExt=null,this.contextRestoredHandler=null;var c=a.getContext("webgl2",b);this.gl=c,this.canvas=a,c.disable(c.DEPTH_TEST),c.disable(c.CULL_FACE),this.setState(),this.initExtensions(),this.width=c.drawingBufferWidth,this.height=c.drawingBufferHeight,this.setViewport(0,0,this.width,this.height),enableBlend(c),setBlendModeNormal(c),this.clearBits=c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT,this.contextLostExt=null,this.contextRestoredHandler=null,a.addEventListener("webglcontextlost",a=>{a.preventDefault();}),a.addEventListener("webglcontextrestored",()=>{this.initExtensions(),this.contextRestoredHandler&&this.contextRestoredHandler();});}setState(){var a=this.gl,b=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),c=a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS),d=a.getExtension("EXT_texture_filter_anisotropic");return this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:Array(b),uniformBuffers:Array(c),freeUniformBufferBases:[],drawFramebuffer:null,readFramebuffer:null,extensions:{debugShaders:a.getExtension("WEBGL_debug_shaders"),multiDrawInstanced:a.getExtension("WEBGL_multi_draw_instanced")},maxTextureUnits:b,maxUniformBuffers:c,maxUniforms:Math.min(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)),textureAnisotropy:d,maxTextureAnisotropy:d?a.getParameter(34047):1,samples:a.getParameter(a.SAMPLES),parallelShaderCompile:!!a.getExtension("KHR_parallel_shader_compile"),multiDrawInstanced:!!a.getExtension("WEBGL_multi_draw_instanced")},this}loseContext(){return this.contextLostExt&&this.contextLostExt.loseContext(),this}restoreContext(){return this.contextLostExt&&this.contextLostExt.restoreContext(),this}onContextRestored(a){return this.contextRestoredHandler=a,this}initExtensions(){var a=this.gl,b="WEBGL_compressed_texture_",c="EXT_disjoint_timer_query";["OES_texture_float_linear","EXT_color_buffer_float","EXT_texture_filter_anisotropic",b+"s3tc",b+"s3tc_srgb",b+"etc",b+"astc",b+"pvrtc",c,c+"_webgl2","KHR_parallel_shader_compile"].forEach(b=>{a.getExtension(b);}),this.contextLostExt=a.getExtension("WEBGL_lose_context");}setViewport(a,b,c,d){var e=this.viewport;return (e.width!==c||e.height!==d||e.x!==a||e.y!==b)&&(e.x=a,e.y=b,e.width=c,e.height=d,this.gl.viewport(a,b,c,d)),this}setDefaultViewport(){return this.setViewport(0,0,this.width,this.height),this}resize(a,b){return this.canvas.width=a,this.canvas.height=b,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.setViewport(0,0,this.width,this.height),this}setColorMask(c,d,e,b){return this.gl.colorMask(c,d,e,b),this}setClearColor(c,d,e,b){return this.gl.clearColor(c,d,e,b),this}setClearMask(a){return this.clearBits=a,this}clear(){return this.gl.clear(this.clearBits),this}getX(a){return 2*(a/this.width)-1}getY(a){return -2*(a/this.height)+1}getXY(a,b){return {x:2*(a/this.width)-1,y:-2*(b/this.height)+1}}getQuadPosition(a,b,c,d){var e=this.getXY(a,b),f=this.getXY(a+c,b),g=this.getXY(a,b+d),h=this.getXY(a+c,b+d);return new Float32Array([e.x,e.y,f.x,f.y,g.x,g.y,g.x,g.y,f.x,f.y,h.x,h.y])}createProgram(a,b){var c=new Program(this.gl,this.state,a,b);return c.link().checkLinkage(),c}createVertexArray(){return new VertexArray(this.gl,this.state)}createVertexBuffer(a,b,c,d){return new VertexBuffer(this.gl,this.state,a,b,c,d)}createMatrixBuffer(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.gl.STATIC_DRAW;return new VertexBuffer(this.gl,this.state,a,0,b,c)}createInterleavedBuffer(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.gl.STATIC_DRAW;return new VertexBuffer(this.gl,this.state,null,a,b,c)}createIndexBuffer(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:this.gl.STATIC_DRAW;return new VertexBuffer(this.gl,this.state,a,b,c,d,!0)}createUniformBuffer(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.gl.DYNAMIC_DRAW;return new UniformBuffer(this.gl,this.state,a,b)}createDrawCall(a,b){return new DrawCall(this.gl,this.state,a,b)}createEmptyTexture2D(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return new Texture(this.gl,this.state,this.gl.TEXTURE_2D,null,a,b,0,!1,c)}createTexture2D(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return !b&&a&&a.width&&(b=a.width),!c&&a&&a.height&&(c=a.height),new Texture(this.gl,this.state,this.gl.TEXTURE_2D,a,b,c,0,!1,d)}}

var fs="#version 300 es\nprecision highp float;\n\nin vec3 vColor;\n\nout vec4 fragColor;\n\nvoid main() {\n    fragColor = vec4(vColor, 1.0);\n}\n",app=new WebGL2Renderer(document.getElementById("game"));app.setClearColor(0,0,0,1);var program=app.createProgram("#version 300 es\n\nlayout(location=0) in vec4 position;\nlayout(location=1) in vec3 color;\n\nout vec3 vColor; \n\nvoid main() {\n    vColor = color;\n    gl_Position = position;\n}\n",fs),positions=app.createVertexBuffer(app.gl.FLOAT,2,new Float32Array([-.5,-.5,.5,-.5,0,.5])),colors=app.createVertexBuffer(app.gl.UNSIGNED_BYTE,3,new Uint8Array([255,0,0,0,255,0,0,0,255])),vertexArray=app.createVertexArray();vertexArray.vertexAttributeBuffer(0,positions),vertexArray.vertexAttributeBuffer(1,colors,{normalized:!0});var drawCall=app.createDrawCall(program,vertexArray);app.clear(),drawCall.draw();
