var Game=function(){function a(a,b){void 0===a&&(a=800),void 0===b&&(b=600),this.canvas=document.createElement("canvas"),this.canvas.width=a,this.canvas.height=b,document.body.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.context.fillStyle="#2d2d2d",this.context.fillRect(0,0,a,b);}return a.prototype.drawImage=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0),this.context.drawImage(a,b,c);},a.prototype.draw=function(a){this.context.fillStyle="#ff0000",this.context.fillText(a,10,40),this.context.fillStyle="#0000ff",this.context.fillText(a,10,20),this.context.fillStyle="#ffff00",this.context.fillText(a,10,60);},a}(),_extendStatics=function extendStatics(a,c){return _extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c;}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);},_extendStatics(a,c)};function __extends(a,c){function b(){this.constructor=a;}_extendStatics(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b);}function __values(a){var b="function"==typeof Symbol&&a[Symbol.iterator],c=0;return b?b.call(a):{next:function next(){return a&&c>=a.length&&(a=void 0),{value:a&&a[c++],done:!a}}}}function __read(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,f,g=c.call(a),h=[];try{for(;(void 0===b||0<b--)&&!(d=g.next()).done;)h.push(d.value);}catch(a){f={error:a};}finally{try{d&&!d.done&&(c=g["return"])&&c.call(g);}finally{if(f)throw f.error}}return h}var BaseLoaderState;(function(a){a[a.IDLE=0]="IDLE",a[a.LOADING=1]="LOADING",a[a.PROCESSING=2]="PROCESSING",a[a.COMPLETE=3]="COMPLETE",a[a.SHUTDOWN=4]="SHUTDOWN",a[a.DESTROYED=5]="DESTROYED";})(BaseLoaderState||(BaseLoaderState={}));var FileState;(function(a){a[a.PENDING=0]="PENDING",a[a.LOADING=1]="LOADING",a[a.LOADED=2]="LOADED",a[a.FAILED=3]="FAILED",a[a.PROCESSING=4]="PROCESSING",a[a.ERRORED=5]="ERRORED",a[a.COMPLETE=6]="COMPLETE",a[a.DESTROYED=7]="DESTROYED",a[a.POPULATED=8]="POPULATED",a[a.TIMED_OUT=9]="TIMED_OUT",a[a.ABORTED=10]="ABORTED";})(FileState||(FileState={}));var BaseLoader=function(){function a(){this.fileGroup="",this.prefix="",this.baseURL="",this.path="",this.maxParallelDownloads=32,this.crossOrigin="",this.state=BaseLoaderState.IDLE,this.progress=0,this.totalToLoad=0,this.totalFailed=0,this.totalComplete=0,this.list=new Set,this.inflight=new Set,this.queue=new Set,this._deleteQueue=new Set,this.state=BaseLoaderState.IDLE;}return a.prototype.setBaseURL=function(a){return void 0===a&&(a=""),""!==a&&"/"!==a.substr(-1)&&(a=a.concat("/")),this.baseURL=a,this},a.prototype.setPath=function(a){return void 0===a&&(a=""),""!==a&&"/"!==a.substr(-1)&&(a=a.concat("/")),this.path=a,this},a.prototype.setFileGroup=function(a){return void 0===a&&(a=""),this.fileGroup=a,this},a.prototype.isLoading=function(){return this.state===BaseLoaderState.LOADING||this.state===BaseLoaderState.PROCESSING},a.prototype.isReady=function(){return this.state===BaseLoaderState.IDLE||this.state===BaseLoaderState.COMPLETE},a.prototype.addFile=function(a){return console.log("addFile"),this.getURL(a),this.list.add(a),this.totalToLoad++,console.log(a),new Promise(function(b,c){a.fileResolve=b,a.fileReject=c;})},a.prototype.start=function(){this.isReady()&&(this.progress=0,this.totalFailed=0,this.totalComplete=0,this.totalToLoad=this.list.size,0===this.totalToLoad?this.loadComplete():(this.state=BaseLoaderState.LOADING,this.inflight.clear(),this.queue.clear(),this._deleteQueue.clear(),this.updateProgress(),this.checkLoadQueue()));},a.prototype.getURL=function(a){return a.url.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?a:void(a.url=this.baseURL+this.path+a.url)},a.prototype.updateProgress=function(){this.progress=1-(this.list.size+this.inflight.size)/this.totalToLoad;},a.prototype.checkLoadQueue=function(){var a,b,c=this;try{for(var d,e=__values(this.list),f=e.next();!f.done&&(d=f.value,(d.state===FileState.POPULATED||d.state===FileState.PENDING&&this.inflight.size<this.maxParallelDownloads)&&(this.inflight.add(d),this.list.delete(d),d.load().then(function(a){return c.nextFile(a,!0)}).catch(function(a){return c.nextFile(a,!1)})),this.inflight.size!==this.maxParallelDownloads);f=e.next());}catch(b){a={error:b};}finally{try{f&&!f.done&&(b=e.return)&&b.call(e);}finally{if(a)throw a.error}}},a.prototype.nextFile=function(a,b){console.log("nextFile",a,b),b?this.queue.add(a):this._deleteQueue.add(a),this.inflight.delete(a),0<this.list.size?(console.log("nextFile - still something in the list"),this.checkLoadQueue()):0===this.inflight.size&&(console.log("nextFile calling finishedLoading"),this.loadComplete());},a.prototype.loadComplete=function(){this.list.clear(),this.inflight.clear(),this.progress=1,this.state=BaseLoaderState.COMPLETE;},a}();function XHRLoader(a){var b,c,d=new XMLHttpRequest;a.xhrLoader=d;var e=a.xhrSettings;d.open("GET",a.url,e.async,e.username,e.password),d.responseType=e.responseType,d.timeout=e.timeout,d.setRequestHeader("X-Requested-With",e.requestedWith),e.header&&e.headerValue&&d.setRequestHeader(e.header,e.headerValue),e.overrideMimeType&&d.overrideMimeType(e.overrideMimeType);var f=new Map([["loadstart",function onLoadStart(b){return a.onLoadStart(b)}],["load",function onLoad(b){return a.onLoad(b)}],["loadend",function onLoadEnd(b){return a.onLoadEnd(b)}],["progress",function onProgress(b){return a.onProgress(b)}],["timeout",function onTimeout(b){return a.onTimeout(b)}],["abort",function onAbort(b){return a.onAbort(b)}],["error",function onError(b){return a.onError(b)}]]);try{for(var g=__values(f),h=g.next();!h.done;h=g.next()){var i=__read(h.value,2),j=i[0],k=i[1];d.addEventListener(j,k);}}catch(a){b={error:a};}finally{try{h&&!h.done&&(c=g.return)&&c.call(g);}finally{if(b)throw b.error}}a.resetXHR=function(){var a,b;try{for(var c=__values(f),e=c.next();!e.done;e=c.next()){var g=__read(e.value,2),h=g[0],i=g[1];d.removeEventListener(h,i);}}catch(b){a={error:b};}finally{try{e&&!e.done&&(b=c.return)&&b.call(c);}finally{if(a)throw a.error}}},d.send();}function XHRSettings(a){return void 0===a&&(a={responseType:"blob",async:!0,username:"",password:"",timeout:0}),{responseType:a.responseType,async:a.async,username:a.username,password:a.password,timeout:a.timeout,header:void 0,headerValue:void 0,requestedWith:"XMLHttpRequest",overrideMimeType:void 0}}function File(a,b,c){return {key:a,url:b,type:c,xhrLoader:void 0,xhrSettings:XHRSettings(),data:null,state:FileState.PENDING,bytesLoaded:0,bytesTotal:0,percentComplete:0,load:function load(){var a=this;return console.log("File.load",this.key),this.state=FileState.PENDING,XHRLoader(this),new Promise(function(b,c){a.loaderResolve=b,a.loaderReject=c;})},onLoadStart:function onLoadStart(){console.log("onLoadStart"),this.state=FileState.LOADING;},onLoad:function onLoad(a){var b=this;console.log("onLoad");var c=this.xhrLoader,d=c.responseURL&&0===c.responseURL.indexOf("file://")&&0===c.status,e=!(a.target&&200!==c.status)||d;4===c.readyState&&400<=c.status&&599>=c.status&&(e=!1),this.onProcess().then(function(){return b.onComplete()}).catch(function(){return b.onError()});},onLoadEnd:function onLoadEnd(){console.log("onLoadEnd"),this.resetXHR(),this.state=FileState.LOADED;},onTimeout:function onTimeout(){console.log("onTimeout"),this.state=FileState.TIMED_OUT;},onAbort:function onAbort(){console.log("onAbort"),this.state=FileState.ABORTED;},onError:function onError(){console.log("onError"),this.state=FileState.ERRORED,this.fileReject&&this.fileReject(this);},onProgress:function onProgress(a){console.log("onProgress"),a.lengthComputable&&(this.bytesLoaded=a.loaded,this.bytesTotal=a.total,this.percentComplete=Math.min(a.loaded/a.total,1),console.log(this.percentComplete,"%"));},onProcess:function onProcess(){return console.log("File.onProcess"),this.state=FileState.PROCESSING,new Promise(function(a){a();})},onComplete:function onComplete(){console.log("onComplete!"),this.state=FileState.COMPLETE,this.fileResolve?this.fileResolve(this):this.loaderResolve&&this.loaderResolve(this);},onDestroy:function onDestroy(){this.state=FileState.DESTROYED;}}}function ImageFile(a,b){b||(b=a+".png");var c=File(a,b,"image");return c.xhrSettings.responseType="blob",c.onProcess=function(){console.log("ImageFile.onProcess"),c.state=FileState.PROCESSING;var a=new Image;return c.data=a,new Promise(function(b,d){a.onload=function(){console.log("ImageFile.onload"),a.onload=null,a.onerror=null,c.state=FileState.COMPLETE,b(c);},a.onerror=function(){console.log("ImageFile.onerror"),a.onload=null,a.onerror=null,c.state=FileState.FAILED,d(c);},console.log("ImageFile.set src",c.url),a.src=c.url,a.complete&&a.width&&a.height&&(console.log("ImageFile.instant"),a.onload=null,a.onerror=null,c.state=FileState.COMPLETE,b(c));})},c}var LoaderPlugin=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.image=function(a,b){return void 0===b&&(b=""),this.addFile(ImageFile(a,b))},b}(BaseLoader),Loader={BaseLoader:BaseLoader,BaseLoaderState:BaseLoaderState,File:File,FileState:FileState,LoaderPlugin:LoaderPlugin,XHRLoader:XHRLoader,XHRSettings:XHRSettings,FileTypes:{ImageFile:ImageFile}},VERSION="4.0.0-alpha.3";

var game=new Game,loader=new Loader.LoaderPlugin;console.log(VERSION),game.draw("Phaser 4 Test 003"),loader.image("logo","../assets/logo.png").then(a=>{for(var d=0;10>d;d++){var b=700*Math.random(),c=500*Math.random();game.drawImage(a.data,b,c);}}).catch(()=>{console.log("failed");}),loader.start();
