!function(){"use strict";function t(t){if("complete"===document.readyState||"interactive"===document.readyState)return void t();const e=()=>{document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",e,!0):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)}const e=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function i(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}class s{constructor(t=1,e=0,i=0,s=0,r=0,a=1,h=0,n=0,o=0,u=0,d=1,c=0,l=0,m=0,x=0,g=1){this.set(t,e,i,s,r,a,h,n,o,u,d,c,l,m,x,g)}set(t=1,e=0,i=0,s=0,r=0,a=1,h=0,n=0,o=0,u=0,d=1,c=0,l=0,m=0,x=0,g=1){return this.m00=t,this.m01=e,this.m02=i,this.m03=s,this.m10=r,this.m11=a,this.m12=h,this.m13=n,this.m20=o,this.m21=u,this.m22=d,this.m23=c,this.m30=l,this.m31=m,this.m32=x,this.m33=g,this}zero(){return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}identity(){return this.set()}getArray(){return[this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}[Symbol.iterator](){return this.getArray()[Symbol.iterator]()}}const r={fragmentShader:"\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color;\n}",vertexShader:"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class a{constructor(t,e={}){this.renderer=t,this.gl=t.gl;const{batchSize:i=2e3,dataSize:s=4,indexSize:a=4,vertexElementSize:h=5,quadIndexSize:n=6,fragmentShader:o=r.fragmentShader,vertexShader:u=r.vertexShader}=e;this.batchSize=i,this.dataSize=s,this.indexSize=a,this.vertexElementSize=h,this.vertexByteSize=h*s,this.quadByteSize=4*this.vertexByteSize,this.quadElementSize=4*h,this.quadIndexSize=n,this.bufferByteSize=i*this.quadByteSize,this.createBuffers(),this.createShaders(o,u)}createBuffers(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new Float32Array(this.bufferByteSize),this.index=new Uint16Array(t);const e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}createShaders(t,e){const i=this.gl,s=this.renderer.maxTextures;let r="";for(let t=0;t<s;t++)t>0&&(r+="\n    else "),t<s-1&&(r+=`if (vTextureId < ${t}.5)`),r+="\n    {",r+=`\n        color = texture2D(uTexture[${t}], vTextureCoord);`,r+="\n    }";t=(t=t.replace(/%count%/gi,`${s}`)).replace(/%forloop%/gi,r);const a=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(a,t),i.compileShader(a);const h=i.createShader(i.VERTEX_SHADER);i.shaderSource(h,e),i.compileShader(h);const n=i.createProgram();i.attachShader(n,h),i.attachShader(n,a),i.linkProgram(n),i.useProgram(n),this.program=n;const o=i.getAttribLocation(n,"aVertexPosition"),u=i.getAttribLocation(n,"aTextureCoord"),d=i.getAttribLocation(n,"aTextureId"),c=i.getUniformLocation(n,"uProjectionMatrix"),l=i.getUniformLocation(n,"uCameraMatrix"),m=i.getUniformLocation(n,"uTexture");i.enableVertexAttribArray(o),i.enableVertexAttribArray(u),i.enableVertexAttribArray(d),this.attribs={position:o,textureCoord:u,textureIndex:d},this.uniforms={projectionMatrix:c,cameraMatrix:l,textureLocation:m}}bind(){const t=this.gl,e=this.renderer,i=this.vertexByteSize,s=this.uniforms,r=this.attribs;t.useProgram(this.program),t.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix),t.uniformMatrix4fv(s.cameraMatrix,!1,e.cameraMatrix),t.uniform1iv(s.textureLocation,e.textureIndex),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.vertexAttribPointer(r.position,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(r.textureCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(r.textureIndex,1,t.FLOAT,!1,i,16),this.count=0}batchSprite(t){this.count===this.batchSize&&this.flush();let e=this.count*this.quadElementSize;const i=this.data,s=t.frame,r=s.texture.glIndex,a=t.vertices;i[e++]=a[0],i[e++]=a[1],i[e++]=s.u0,i[e++]=s.v0,i[e++]=r,i[e++]=a[4],i[e++]=a[5],i[e++]=s.u0,i[e++]=s.v1,i[e++]=r,i[e++]=a[6],i[e++]=a[7],i[e++]=s.u1,i[e++]=s.v1,i[e++]=r,i[e++]=a[2],i[e++]=a[3],i[e++]=s.u1,i[e++]=s.v0,i[e++]=r,this.count++}flush(){const t=this.count;if(0===t)return;const e=this.gl,i=t*this.quadByteSize;if(i===this.bufferByteSize)e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW);else{let t=this.data.subarray(0,i);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,t*this.quadIndexSize,e.UNSIGNED_SHORT,0),this.count=0}}class h{constructor(t,e){this.contextOptions={alpha:!1,antialias:!0,premultipliedAlpha:!1,stencil:!1,preserveDrawingBuffer:!1},this.clearColor=[0,0,0,1],this.resolution={x:0,y:0},this.maxTextures=0,this.resolution.x=t,this.resolution.y=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.gl=this.canvas.getContext("webgl",this.contextOptions),this.getMaxTextures(),this.shader=new a(this),this.activeTextures=Array(this.maxTextures),this.projectionMatrix=function(t,e,i,r,a,h){const n=1/(t-e),o=1/(i-r),u=1/(a-h);return new s(-2*n,0,0,0,0,-2*o,0,0,0,0,2*u,0,(t+e)*n,(r+i)*o,(h+a)*u,1)}(0,t,e,0,-1e3,1e3),this.cameraMatrix=new s,this.startActiveTexture=0}setBackgroundColor(t){const e=this.clearColor;let i=t>>16&255,s=t>>8&255,r=255&t,a=t>16777215?t>>>24:255;return e[0]=i/255,e[1]=s/255,e[2]=r/255,e[3]=a/255,this}getMaxTextures(){const t=this.gl;let s=function(t,s){const r=s.createShader(s.FRAGMENT_SHADER);for(;;){const a=e.replace(/%forloop%/gi,i(t));if(s.shaderSource(r,a),s.compileShader(r),s.getShaderParameter(r,s.COMPILE_STATUS))break;t=t/2|0}return t}(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t);for(let e=0;e<s;e++){let i=t.createTexture();t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]))}this.maxTextures=s,this.textureIndex=Array.from(Array(s).keys())}createGLTexture(t){const e=this.gl,i=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i}render(t){this.startActiveTexture++;let e=this.startActiveTexture,i=0;const s=this.shader,r=this.maxTextures,a=this.activeTextures,h=this.gl,n=this.clearColor;h.clearColor(n[0],n[1],n[2],n[3]),h.clear(h.COLOR_BUFFER_BIT),h.enable(h.BLEND),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA),h.viewport(0,0,this.resolution.x,this.resolution.y),s.bind();for(let n=0;n<t.length;n++){let o=t[n],u=o.texture;u.glIndexCounter<e&&(u.glIndexCounter=e,i<r&&(a[i]=u,u.glIndex=i,h.activeTexture(h.TEXTURE0+i),h.bindTexture(h.TEXTURE_2D,u.glTexture),i++)),o.update(),o.visible&&s.batchSprite(o)}s.flush()}}class n{constructor(t,e,i,s,r){this.hasLoaded=!1,this.type=t,this.key=e,this.url=i,this.loadHandler=s,this.config=r}}class o{constructor(t){this.baseURL="",this.path="",this.crossOrigin=void 0,this.maxParallelDownloads=32,this.isLoading=!1,this.game=t,this.reset()}reset(){this.isLoading=!1,this.queue=[],this.inflight=new Map}start(t){this.isLoading||(this.queue.length>0?(this.isLoading=!0,this.onComplete=t,this.nextFile()):t())}nextFile(){if(this.queue.length){let t=this.queue.shift();this.inflight.set(t.url,t),t.loadHandler(t)}else 0===this.inflight.size&&this.stop()}stop(){this.isLoading=!1,this.onComplete()}fileComplete(t){this.inflight.delete(t.url),this.nextFile()}fileError(t){this.inflight.delete(t.url),this.nextFile()}totalFilesToLoad(){return this.queue.length+this.inflight.size}image(t,e){let i=new n("image",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t));return this.queue.push(i),this}spritesheet(t,e,i){let s=new n("spritesheet",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t));return s.config=i,this.queue.push(s),this}imageTagLoader(t){t.data=new Image,this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.onload=()=>{t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,"image"===t.type?this.game.textures.addImage(t.key,t.data):"spritesheet"===t.type&&this.game.textures.addSpriteSheet(t.key,t.data,t.config),this.fileComplete(t)},t.data.onerror=()=>{t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,this.fileError(t)},t.data.src=t.url,t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,"image"===t.type?this.game.textures.addImage(t.key,t.data):"spritesheet"===t.type&&this.game.textures.addSpriteSheet(t.key,t.data,t.config),this.fileComplete(t))}getURL(t,e,i){return e||(e=t+i),this.baseURL+this.path+e}setBaseURL(t){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this}setPath(t){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}}class u{constructor(t){this.scene=t,this.game=t.game,this.list=[]}add(t){const e=this.list;return-1===e.indexOf(t)&&e.push(t),this}remove(t){const e=this.list,i=e.indexOf(t);return-1!==i&&e.splice(i,1),this}}class d{constructor(t,e,i,s,r,a){this.texture=t,this.key=e,this.x=i,this.y=s,this.width=r,this.height=a,this.updateUVs()}updateUVs(){const{x:t,y:e,width:i,height:s}=this,r=this.texture.width,a=this.texture.height;this.u0=t/r,this.v0=e/a,this.u1=(t+i)/r,this.v1=(e+s)/a}}class c{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}zero(){return this.set()}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}[Symbol.iterator](){return this.getArray()[Symbol.iterator]()}}class l{constructor(t,e,i,s,r){this.rgba={r:1,g:1,b:1,a:1},this.visible=!0,this.texture=null,this.frame=null,this.vertices=[0,0,0,0,0,0,0,0],this._size=new c,this._position=new c,this._scale=new c(1,1),this._skew=new c,this._origin=new c(.5,.5),this._rotation=0,this._a=1,this._b=0,this._c=0,this._d=1,this._tx=0,this._ty=0,this.scene=t,this.setTexture(s,r),this._position.set(e,i),this._tx=e,this._ty=i}setTexture(t,e){return this.texture=t instanceof class{constructor(t,e){this.glIndex=0,this.glIndexCounter=-1,this.key=t,this.image=e,this.frames=new Map,this.width=this.image.width,this.height=this.image.height,this.add("__BASE",0,0,this.width,this.height)}add(t,e,i,s,r){if(this.frames.has(t))return null;let a=new d(this,t,e,i,s,r);return this.frames.set(t,a),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=a),a}get(t){if(!t)return this.firstFrame;let e=this.frames.get(t);return e||(console.warn("Texture.frame missing: "+t),e=this.firstFrame),e}}?t:this.scene.textures.get(t),this.setFrame(e)}setFrame(t){return this.frame=this.texture.get(t),this._size.set(this.frame.width,this.frame.height),this}setPosition(t,e){return this._position.set(t,e),this}setScale(t,e=t){return this._scale.set(t,e),this.updateCache()}setSkew(t,e){return this._skew.set(t,e),this.updateCache()}setOrigin(t,e=t){return this._origin.set(t,e),this}setRotation(t){return this._rotation=t,this.updateCache()}updateCache(){const{_rotation:t,_skew:e,_scale:i}=this;return this._a=Math.cos(t+e.y)*i.x,this._b=Math.sin(t+e.y)*i.x,this._c=-Math.sin(t-e.x)*i.y,this._d=Math.cos(t-e.x)*i.y,this}update(){this._tx=this.x,this._ty=this.y;const t=this._size.x,e=this._size.y,i=-this._origin.x*t,s=i+t,r=-this._origin.y*e,a=r+e,{_a:h,_b:n,_c:o,_d:u,_tx:d,_ty:c}=this,l=i*h,m=i*n,x=r*o,g=r*u,f=s*h,p=s*n,_=a*o,T=a*u,E=this.vertices;E[0]=l+x+d,E[1]=m+g+c,E[2]=f+x+d,E[3]=p+g+c,E[4]=l+_+d,E[5]=m+T+c,E[6]=f+_+d,E[7]=p+T+c}set x(t){this._position.x=t}get x(){return this._position.x}set y(t){this._position.y=t}get y(){return this._position.y}set rotation(t){this._rotation=t,this.updateCache()}get rotation(){return this._rotation}set scaleX(t){this._scale.x=t,this.updateCache()}get scaleX(){return this._scale.x}set scaleY(t){this._scale.y=t,this.updateCache()}get scaleY(){return this._scale.y}set skewX(t){this._skew.x=t,this.updateCache()}get skewX(){return this._skew.x}set skewY(t){this._skew.y=t,this.updateCache()}get skewY(){return this._skew.y}}class m{constructor(t){this.scene=t,this.displayList=t.children}sprite(t,e,i,s){let r=new l(this.scene,t,e,i,s);return this.displayList.add(r),r}}class x{constructor(t){this.game=t,this.load=t.loader,this.textures=t.textures,this.children=new u(this),this.add=new m(this)}init(){}preload(){}create(){}update(t){}}class g{constructor(t,e){this.glIndex=0,this.glIndexCounter=-1,this.key=t,this.image=e,this.frames=new Map,this.width=this.image.width,this.height=this.image.height,this.add("__BASE",0,0,this.width,this.height)}add(t,e,i,s,r){if(this.frames.has(t))return null;let a=new d(this,t,e,i,s,r);return this.frames.set(t,a),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=a),a}get(t){if(!t)return this.firstFrame;let e=this.frames.get(t);return e||(console.warn("Texture.frame missing: "+t),e=this.firstFrame),e}}class f{constructor(t){this.game=t,this.textures=new Map}get(t){return this.textures.has(t)?this.textures.get(t):this.textures.get("__MISSING")}addImage(t,e){let i=null;return this.textures.has(t)||(i=new g(t,e),i.glTexture=this.game.renderer.createGLTexture(i.image),this.textures.set(t,i)),i}addSpriteSheet(t,e,i){let s=null;return this.textures.has(t)||(s=new g(t,e),s.glTexture=this.game.renderer.createGLTexture(s.image),function(t,e,i,s,r,a){let{frameWidth:h=null,frameHeight:n=null,startFrame:o=0,endFrame:u=-1,margin:d=0,spacing:c=0}=a;if(n||(n=h),null===h)throw new Error("TextureManager.SpriteSheet: Invalid frameWidth given.");let l=Math.floor((s-d+c)/(h+c))*Math.floor((r-d+c)/(n+c));0===l&&console.warn("SpriteSheet frame dimensions will result in zero frames."),(o>l||o<-l)&&(o=0),o<0&&(o=l+o),-1!==u&&(l=o+(u+1));let m=d,x=d,g=0,f=0;for(let a=0;a<l;a++){g=0,f=0;let o=m+h,u=x+n;o>s&&(g=o-s),u>r&&(f=u-r),t.add(a,e+m,i+x,h-g,n-f),m+=h+c,m+h>s&&(m=d,x+=n+c)}}(s,0,0,s.width,s.height,i),this.textures.set(t,s)),s}}class p{constructor(e){this.VERSION="4.0.0-beta1",this.isPaused=!1,this.isBooted=!1;const{width:i=800,height:s=600,backgroundColor:r=0,parent:a=document.body,scene:h=new x(this)}=e;this.scene=h,t(()=>this.boot(i,s,r,a))}boot(t,e,i,s){this.isBooted=!0,this.textures=new f(this),this.loader=new o(this);const r=new h(t,e);r.setBackgroundColor(i),function(t,e){let i;if(e)"string"==typeof e?i=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(i=e);else if(t.parentElement)return t;i||(i=document.body),i.appendChild(t)}(r.canvas,s),this.renderer=r,this.banner(this.VERSION);const a=this.scene;a instanceof x?this.scene=this.createSceneFromInstance(a):"object"==typeof a?this.scene=this.createSceneFromObject(a):"function"==typeof a&&(this.scene=this.createSceneFromFunction(a)),this.scene.init(),this.scene.preload(),this.loader.totalFilesToLoad()>0?this.loader.start(()=>this.start()):this.start()}createSceneFromInstance(t){return t.game=this,t.load=this.loader,t}createSceneFromObject(t){let e=new x(this);return["init","preload","create","update","render"].forEach(i=>{t.hasOwnProperty(i)&&(e[i]=t[i])}),e}createSceneFromFunction(t){var e=new t(this);return e instanceof x?this.createSceneFromInstance(e):e}start(){this.scene.create(),requestAnimationFrame(t=>this.step(t))}banner(t){let e="";const i=[e];let s;["#e000e0","#8000e0","#2000e0","#0000c0","#000080"].forEach(t=>{e=e.concat("%c "),i.push("background: "+t),s=t}),i[i.length-1]="color: #ffffff; background: "+s,i.push("background: rgba(0,0,0,0)"),e=e.concat("Phaser Nano v"+t),e=e.concat(" %c https://phaser4.io"),i[0]=e,console.log.apply(console,i)}step(t){this.isPaused?requestAnimationFrame(t=>this.step(t)):(this.scene.update(t),this.renderer.render(this.scene.children.list),requestAnimationFrame(t=>this.step(t)))}}class _ extends x{constructor(t){super(t)}preload(){this.load.setPath("../assets"),this.load.spritesheet("diamonds","diamonds32x24x5.png",{frameWidth:32,frameHeight:24}),this.load.spritesheet("pack","32x32-item-pack.png",{frameWidth:32,frameHeight:32})}create(){document.getElementById("toggle").addEventListener("click",()=>{this.game.isPaused=!this.game.isPaused});const t=this.textures.get("diamonds").frames.size-1,e=this.textures.get("pack").frames.size-1;for(let t=0;t<128;t++){let t=Math.floor(Math.random()*this.game.renderer.resolution.x),i=Math.floor(Math.random()*this.game.renderer.resolution.y),s=Math.floor(Math.random()*e);this.add.sprite(t,i,"pack",s)}for(let e=0;e<64;e++){let e=Math.floor(Math.random()*this.game.renderer.resolution.x),i=Math.floor(Math.random()*this.game.renderer.resolution.y),s=Math.floor(Math.random()*t);this.add.sprite(e,i,"diamonds",s)}}}new p({width:800,height:600,backgroundColor:102,parent:"gameParent",scene:_})}();
