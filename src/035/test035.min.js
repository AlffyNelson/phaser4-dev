!function(){"use strict";class t{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}zero(){return this.set()}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}[Symbol.iterator](){return this.getArray()[Symbol.iterator]()}}class e{constructor(e,i,s){this.rgba={r:1,g:1,b:1,a:1},this.visible=!0,this.texture=null,this.uv={topLeft:{x:0,y:0},topRight:{x:1,y:0},bottomLeft:{x:0,y:1},bottomRight:{x:1,y:1}},this.bounds=null,this._a=1,this._b=0,this._c=0,this._d=1,this._tx=0,this._ty=0,this.gravity=.75,this.speedX=10*Math.random(),this.speedY=10*Math.random()-5,this.texture=s,this._size=new t(s.width,s.height),this.topLeft=new t,this.topRight=new t,this.bottomLeft=new t,this.bottomRight=new t,this._position=new t(e,i),this._scale=new t(1,1),this._skew=new t(0,0),this._origin=new t(0,0),this._rotation=0,this.setOrigin(.5,1)}setOrigin(t,e=t){return this._origin.set(t,e),this}updateCache(){const{_rotation:t,_skew:e,_scale:i}=this;this._a=Math.cos(t+e.y)*i.x,this._b=Math.sin(t+e.y)*i.x,this._c=-Math.sin(t-e.x)*i.y,this._d=Math.cos(t-e.x)*i.y}setTexture(t){return this.texture=t,this._size.set(t.width,t.height),this}step(t,e){this.x+=this.speedX,this.y+=this.speedY,this.speedY+=this.gravity,this.x>this.bounds.right?(this.speedX*=-1,this.x=this.bounds.right):this.x<this.bounds.left&&(this.speedX*=-1,this.x=this.bounds.left),this.y>this.bounds.bottom?(this.speedY*=-.85,this.y=this.bounds.bottom,Math.random()>.5&&(this.speedY-=6*Math.random())):this.y<this.bounds.top&&(this.speedY=0,this.y=this.bounds.top),this._tx=this.x,this._ty=this.y;const i=this._size.x,s=this._size.y,o=-this._origin.x*i,h=o+i,n=-this._origin.y*s,r=n+s,{_a:a,_b:d,_c:u,_d:m,_tx:g,_ty:c}=this,x=o*a,l=o*d,_=n*u,b=n*m,R=h*a,E=h*d,f=r*u,p=r*m;this.topLeft.set(x+_+g,l+b+c),this.topRight.set(R+_+g,E+b+c),this.bottomLeft.set(x+f+g,l+p+c),this.bottomRight.set(R+f+g,E+p+c);const y=this.texture.glIndex;t[e+0]=this.topLeft.x,t[e+1]=this.topLeft.y,t[e+2]=this.uv.topLeft.x,t[e+3]=this.uv.topLeft.y,t[e+4]=y,t[e+5]=this.bottomLeft.x,t[e+6]=this.bottomLeft.y,t[e+7]=this.uv.bottomLeft.x,t[e+8]=this.uv.bottomLeft.y,t[e+9]=y,t[e+10]=this.bottomRight.x,t[e+11]=this.bottomRight.y,t[e+12]=this.uv.bottomRight.x,t[e+13]=this.uv.bottomRight.y,t[e+14]=y,t[e+15]=this.topRight.x,t[e+16]=this.topRight.y,t[e+17]=this.uv.topRight.x,t[e+18]=this.uv.topRight.y,t[e+19]=y}stepNoTexture(t,e){this.x+=this.speedX,this.y+=this.speedY,this.speedY+=this.gravity,this.x>this.bounds.right?(this.speedX*=-1,this.x=this.bounds.right):this.x<this.bounds.left&&(this.speedX*=-1,this.x=this.bounds.left),this.y>this.bounds.bottom?(this.speedY*=-.85,this.y=this.bounds.bottom,Math.random()>.5&&(this.speedY-=6*Math.random())):this.y<this.bounds.top&&(this.speedY=0,this.y=this.bounds.top),this._tx=this.x,this._ty=this.y;const i=this._size.x,s=this._size.y,o=-this._origin.x*i,h=o+i,n=-this._origin.y*s,r=n+s,{_a:a,_b:d,_c:u,_d:m,_tx:g,_ty:c}=this,x=o*a,l=o*d,_=n*u,b=n*m,R=h*a,E=h*d,f=r*u,p=r*m;this.topLeft.set(x+_+g,l+b+c),this.topRight.set(R+_+g,E+b+c),this.bottomLeft.set(x+f+g,l+p+c),this.bottomRight.set(R+f+g,E+p+c),t[e+0]=this.topLeft.x,t[e+1]=this.topLeft.y,t[e+2]=this.uv.topLeft.x,t[e+3]=this.uv.topLeft.y,t[e+4]=this.bottomLeft.x,t[e+5]=this.bottomLeft.y,t[e+6]=this.uv.bottomLeft.x,t[e+7]=this.uv.bottomLeft.y,t[e+8]=this.bottomRight.x,t[e+9]=this.bottomRight.y,t[e+10]=this.uv.bottomRight.x,t[e+11]=this.uv.bottomRight.y,t[e+12]=this.topRight.x,t[e+13]=this.topRight.y,t[e+14]=this.uv.topRight.x,t[e+15]=this.uv.topRight.y}set x(t){this._position.x=t}get x(){return this._position.x}set y(t){this._position.y=t}get y(){return this._position.y}}class i{constructor(t,e,i=0){this.glIndex=0,this.key=t,this.gl=e,this.glIndex=i}onLoad(){const t=this.gl;this.glTexture=this.gl.createTexture(),t.activeTexture(t.TEXTURE0+this.glIndex),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.image),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.width=this.image.width,this.height=this.image.height,this.image.onload=null,this._onLoadCallback&&this._onLoadCallback(this)}load(t,e){this.image=new Image,this.image.onload=()=>this.onLoad(),this.image.src=t,e&&(this._onLoadCallback=e),this.image.complete&&this.image.width&&this.image.height&&this.onLoad()}}var s={fragmentShader:"\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uTexture;\n\nvoid main (void)\n{\n    gl_FragColor = texture2D(uTexture, vTextureCoord);\n}",vertexShader:"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n\n    gl_Position = uProjectionMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};!function(t){if("complete"===document.readyState||"interactive"===document.readyState)return void t();const e=()=>{document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",e,!0):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)}((function(){const t=800,o=600,h={left:0,top:0,right:t,bottom:o},n=document.getElementById("game");n.width=t,n.height=o;const r=n.getContext("webgl",{alpha:!1,antialias:!1,premultipliedAlpha:!1,stencil:!1,preserveDrawingBuffer:!1}),a=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(a,s.fragmentShader),r.compileShader(a);const d=r.createShader(r.VERTEX_SHADER);r.shaderSource(d,s.vertexShader),r.compileShader(d);const u=r.createProgram();r.attachShader(u,d),r.attachShader(u,a),r.linkProgram(u),r.useProgram(u);const m=r.getAttribLocation(u,"aVertexPosition"),g=r.getAttribLocation(u,"aTextureCoord"),c=r.getUniformLocation(u,"uProjectionMatrix"),x=r.getUniformLocation(u,"uTexture");r.enableVertexAttribArray(m),r.enableVertexAttribArray(g);let l=0,_=!1;const b=new Float32Array(262144);let R=[];for(let t=0;t<16384;t+=4)R.push(t+0,t+1,t+2,t+2,t+3,t+0);const E=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,E),r.bufferData(r.ARRAY_BUFFER,b,r.DYNAMIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null);const f=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(R),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null);const p=new Float32Array([1/-t*-2,0,0,0,0,1/o*-2,0,0,0,0,1/(-1e3-1e3)*2,0,-1,1,0,1]),y=[];!function(t){let e=t.length;const s=()=>{e--,0===e&&function(){v(1e3);let t=document.getElementById("gameParent");L=new window.Stats,L.domElement.id="stats",document.body.append(L.domElement),A=document.createElement("div"),A.innerText=l.toString(),t.append(A),document.getElementById("toggle").addEventListener("click",()=>{w=!w});let e=document.getElementById("game");e.addEventListener("mousedown",()=>{_=!0}),e.addEventListener("mouseup",()=>{_=!1});for(let t=0;t<y.length;t++)r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,y[t].glTexture);r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f),r.bindBuffer(r.ARRAY_BUFFER,E),U()}()};t.forEach(t=>{let e=new i(t,r,y.length);e.load("../assets/bunnies/"+t,s),y.push(e)})}(["rabbitv3.png"]);const T=[];function v(t){for(let i=0;i<t;i++){let t=new e(l%2*800,0,y[0]);t.bounds=h,T.push(t),l++}}let L,A,w=!1;function F(t){const e=64*t;if(262144===e)r.bufferData(r.ARRAY_BUFFER,b,r.DYNAMIC_DRAW);else{let t=b.subarray(0,e);r.bufferSubData(r.ARRAY_BUFFER,0,t)}r.drawElements(r.TRIANGLES,6*t,r.UNSIGNED_SHORT,0)}function U(){if(w)return void requestAnimationFrame(U);L.begin(),_&&l<2e5&&(v(200),A.innerText=l.toString()),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),r.viewport(0,0,n.width,n.height),r.uniformMatrix4fv(c,!1,p),r.uniform1i(x,0),r.vertexAttribPointer(m,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(g,2,r.FLOAT,!1,16,8);let t=0;for(let e=0;e<T.length;e++){T[e].stepNoTexture(b,16*t),4096===t?(F(t),t=0):t++}t>0&&F(t),requestAnimationFrame(U),L.end()}window.bunnies=T,console.log("max",4096,"size",262144)}))}();
